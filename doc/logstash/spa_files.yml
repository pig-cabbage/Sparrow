# The # character at the beginning of a line indicates a comment. Use
# comments to describe your configuration.
input {
    jdbc {
        # 待修改
        jdbc_driver_class => "com.mysql.cj.jdbc.Driver"
        jdbc_driver_library => "D:\\Program\\Elastic\\script\\mysql-connector-java-8.0.11.jar"
        jdbc_connection_string => "jdbc:mysql://localhost:3306/legal?requireSSL=true&useSSL=true&verifyServerCertificate=false&serverTimezone=Hongkong&useUnicode=true&characterEncoding=utf-8"
        jdbc_user => "root"
        jdbc_password => "123456" # 待修改
        jdbc_default_timezone => "Hongkong"
        lowercase_column_names => false
        statement => "
        select concat('image_', `id`) as `id`,
        concat('image_', `id`) as `original_id`,
        `title`,
        date_format(str_to_date(`created_time`, '%Y/%m/%d %H:%i'), get_format(DATETIME, 'JIS')) as `created_time`,
        date_format(str_to_date(`modified_time`, '%Y/%m/%d %H:%i'), get_format(DATETIME, 'JIS')) as `modified_time`,
        `desc`,
        `creator`,
        `content`,

        'image' as `type`,
        CASE FLOOR(RAND() * 3)
            WHEN 0 THEN 'jpg'
            WHEN 1 THEN 'png'
            WHEN 2 THEN 'gif'
        END as `ext`,

        1024 as `size`,
        NULL as `store_key`,
        NULL as `thumbnail`, 
        NULL as `derived_files`,
        NULL as `doc_id`,
        0 as `version`,
        NULL as `parent_id`
        from `file_t`
        
        "
    }
}
# The filter part of this file is commented out to indicate that it is
# optional
filter {
    
}
output {
    stdout { codec => rubydebug }
    elasticsearch {
        hosts => [ "10.0.0.1:9200" ] # 待修改
        index => "legal_files" # 待修改
        action => "update"
        doc_as_upsert => "true"
        document_type => "_doc"
        document_id => "%{id}"
    }
}