#### 技术方案

***

sparrow项目涉及与Minio相关的有文件上传、下载和删除。

##### 文件上传

图1为文件上传的流程图。

在用户选择上传文件时，客户端首先向应用服务器请求获取上传文件到Minio的url，在获取到应用服务器返回的url之后，客户端直接向Minio主机发送该上传文件url的PUT请求。客户端接收到Minio上传成功后的响应后，调用应用服务器的创建文件元数据接口，应用服务器往Elastic Search数据库中创建文件元数据和更新文档元数据，最后将处理结果返回给客户端。

![文件上传流程](assets\文件上传流程.jpg)

<center>图1 : 文件上传流程图</center>
##### 文件下载

图2为文件下载的流程图。

用户首先通过客户端向应用服务器发送获取指定文件请求。应用服务器接收到请求之后在Elastic Search中查找指定文件元数据，获取到元数据之后，根据元数据提供的文件存储位置信息通过Minio的Java SDK提供的方法生成文件地址URL并将文件URL返回客户端。客户端接收到文件URL后通过URL直接访问OSS获取文件。

![文件下载流程图](assets\minio文件下载流程图.jpg)

<center>图2 : 文件下载流程图</center>
